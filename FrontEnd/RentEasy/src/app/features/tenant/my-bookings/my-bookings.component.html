<div class="my-bookings-page">
  <div class="container">
    <div class="page-header animate-slide-up">
      <h1>My <span class="gradient-text">Bookings</span></h1>
      <p>Track your rental booking history</p>
    </div>

    @if (isLoading) {
      <div class="loading-state">
        <mat-spinner diameter="48"></mat-spinner>
        <p>Loading your bookings...</p>
      </div>
    } @else if (bookings.length === 0) {
      <div class="empty-state animate-fade-in">
        <mat-icon>event_note</mat-icon>
        <h3>No Bookings Yet</h3>
        <p>You haven't made any bookings yet. Start exploring properties!</p>
        <a routerLink="/properties" class="btn btn-primary">
          <mat-icon>search</mat-icon>
          Browse Properties
        </a>
      </div>
    } @else {
      <mat-tab-group animationDuration="200ms" class="animate-fade-in">
        <!-- All Bookings -->
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="tab-label">All ({{ bookings.length }})</span>
          </ng-template>
          <div class="bookings-grid">
            @for (booking of bookings; track booking.id) {
              <div class="booking-card" [class.status-pending]="booking.status === 'Pending'" 
                   [class.status-approved]="booking.status === 'Approved'"
                   [class.status-rejected]="booking.status === 'Rejected'">
                <div class="booking-header">
                  <h3>{{ booking.property_title }}</h3>
                  <span class="badge" 
                        [class.badge-pending]="booking.status === 'Pending'"
                        [class.badge-approved]="booking.status === 'Approved'"
                        [class.badge-rejected]="booking.status === 'Rejected'">
                    {{ booking.status }}
                  </span>
                </div>
                <p class="location">{{ booking.property_location }}</p>
                <div class="booking-details">
                  <div class="detail-item">
                    <mat-icon>event</mat-icon>
                    <div>
                      <span class="label">Check-in</span>
                      <span class="value">{{ booking.check_in | date:'MMM d, yyyy' }}</span>
                    </div>
                  </div>
                  <div class="detail-item">
                    <mat-icon>event</mat-icon>
                    <div>
                      <span class="label">Check-out</span>
                      <span class="value">{{ booking.check_out | date:'MMM d, yyyy' }}</span>
                    </div>
                  </div>
                  <div class="detail-item">
                    <mat-icon>nights_stay</mat-icon>
                    <div>
                      <span class="label">Duration</span>
                      <span class="value">{{ getDays(booking) }} days</span>
                    </div>
                  </div>
                </div>
                @if (booking.status === 'Pending') {
                  <div class="booking-actions">
                    <button class="btn btn-danger" (click)="cancelBooking(booking)" 
                            [disabled]="cancellingId === booking.id">
                      @if (cancellingId === booking.id) {
                        <mat-spinner diameter="18"></mat-spinner>
                      } @else {
                        <mat-icon>close</mat-icon>
                        Cancel Booking
                      }
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        </mat-tab>

        <!-- Pending -->
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="tab-label">
              Pending
              @if (pendingBookings.length > 0) {
                <span class="tab-count">{{ pendingBookings.length }}</span>
              }
            </span>
          </ng-template>
          @if (pendingBookings.length === 0) {
            <div class="empty-tab">
              <mat-icon>pending</mat-icon>
              <p>No pending bookings</p>
            </div>
          } @else {
            <div class="bookings-grid">
              @for (booking of pendingBookings; track booking.id) {
                <div class="booking-card status-pending">
                  <div class="booking-header">
                    <h3>{{ booking.property_title }}</h3>
                    <span class="badge badge-pending">Pending</span>
                  </div>
                  <p class="location">{{ booking.property_location }}</p>
                  <div class="booking-details">
                    <div class="detail-item">
                      <mat-icon>event</mat-icon>
                      <div>
                        <span class="label">Check-in</span>
                        <span class="value">{{ booking.check_in | date:'MMM d, yyyy' }}</span>
                      </div>
                    </div>
                    <div class="detail-item">
                      <mat-icon>event</mat-icon>
                      <div>
                        <span class="label">Check-out</span>
                        <span class="value">{{ booking.check_out | date:'MMM d, yyyy' }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="booking-actions">
                    <button class="btn btn-danger" (click)="cancelBooking(booking)" 
                            [disabled]="cancellingId === booking.id">
                      @if (cancellingId === booking.id) {
                        <mat-spinner diameter="18"></mat-spinner>
                      } @else {
                        <mat-icon>close</mat-icon>
                        Cancel
                      }
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </mat-tab>

        <!-- Approved -->
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="tab-label">Approved ({{ approvedBookings.length }})</span>
          </ng-template>
          @if (approvedBookings.length === 0) {
            <div class="empty-tab">
              <mat-icon>event_available</mat-icon>
              <p>No approved bookings</p>
            </div>
          } @else {
            <div class="bookings-grid">
              @for (booking of approvedBookings; track booking.id) {
                <div class="booking-card status-approved">
                  <div class="booking-header">
                    <h3>{{ booking.property_title }}</h3>
                    <span class="badge badge-approved">Approved</span>
                  </div>
                  <p class="location">{{ booking.property_location }}</p>
                  <div class="booking-details">
                    <div class="detail-item">
                      <mat-icon>event</mat-icon>
                      <div>
                        <span class="label">Check-in</span>
                        <span class="value">{{ booking.check_in | date:'MMM d, yyyy' }}</span>
                      </div>
                    </div>
                    <div class="detail-item">
                      <mat-icon>event</mat-icon>
                      <div>
                        <span class="label">Check-out</span>
                        <span class="value">{{ booking.check_out | date:'MMM d, yyyy' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        </mat-tab>
      </mat-tab-group>
    }
  </div>
</div>
